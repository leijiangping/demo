<!DOCTYPE html>
<html lang="ch">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="renderer" content="webkit">
	<meta HTTP-EQUIV="pragma" CONTENT="no-cache"> 
	<meta HTTP-EQUIV="Cache-Control" CONTENT="no-store, must-revalidate"> 
	<meta HTTP-EQUIV="expires" CONTENT="0">
	<link rel="stylesheet" href="../css/ncms.css">
	<script type="text/javascript" src="../lib/jquery.js"></script>
	<script type="text/javascript" src="../bootstrap/js/ui.loading.js"></script>
	<script type="text/javascript" src="../js/sccl.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<!--[if lte IE 9]>
	    <script src="asserts/bootstrap/js/html5shiv.js"></script>
	    <script src="asserts/bootstrap/js/respond.min.js"></script>
	    <script src="asserts/bootstrap/js/jquery.placeholder.min.js"></script>
    <![endif]-->
    <script src="../bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>

<div class="home-parent">
	<div class="home_top clear">
		<div class="task_agents" id="taskagents">
			<img src="../image/task.png" alt="待办任务"/>
			<div>
				<p class="digit">-</p>
				<p class="digit_type">待办任务</p>
			</div>
		</div>
		<div class="work_order">
			<img src="../image/order.png" alt="我的工单"/>
			<div>
				<p class="digit">5</p>
				<p class="digit_type">我的工单</p>
			</div>
		</div>
		<div class="task_participation">
			<img src="../image/participation.png" alt="参与的任务"/>
			<div>
				<p class="digit">4</p>
				<p class="digit_type">参与的任务</p>
			</div>
		</div>
		<div class="my_draft">
			<img src="../image/draft.png" alt="我的草稿"/>
			<div>
				<p class="digit">1</p>
				<p class="digit_type">我的草稿</p>
			</div>
		</div>
	</div>
	
	<div class="clear">
		<div class="home-center1">
			<div style="width: 50%;height:100%;float:left;position: absolute;">
				<!-- <span id="chartText">上海市2017年度各项费用汇总图</span> -->
				<div id="mapchart" style="width:100%;height:100%;top:30px;"></div>
			</div>
			<div id="linechart" style="width: 50%;height:100%;float:left;position: absolute;left:50%;"></div>
		</div>
		<div id="home-left" class="home-left">
			
			<div id="main-bing1" style="width: 100%;height:33%;border-bottom:1px solid #d9d9d9;"></div>
			<div id="main-bing2" style="width: 100%;height:33%;border-bottom:1px solid #d9d9d9;"></div>
			<div id="main-bing3" style="width: 100%;height:33%;"></div>
		</div>
	</div>
	<div class="home_bottom clear">
		<div class="room_rate">
			<div class="firstBlock"></div>
			<div class="secondBlock">
				<p class="digit">未关联机房资源数：<span class="nolinkedres">-</span></p>
				<p class="digit_type">机房资源总数：<span class="allres">-</span></p>
			</div>
		</div>
		<div class="electric_rate">
			<div class="firstBlock"></div>
			<div class="secondBlock">
				<p class="digit">未关联电表数：<span class="nolinkedmeter">-</span></p>
				<p class="digit_type">电表总数：<span class="allmeter">-</span></p>
			</div>
		</div>
		<div class=" contract_rate">
			<div class="firstBlock"></div>
			<div class="secondBlock">
				<p class="digit" style="margin-top: 45px;">报账点数：<span class="allaccount">-</span></p>
			</div>
		</div>
		<div class="reim_rate">
			<div class="firstBlock"></div>
			<div class="secondBlock">
				<p class="digit">已推送汇总单数：<span class="pushedBill">-</span></p>
				<p class="digit_type">已报账单数：<span class="allpushbill">-</span></p>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="../echart/echarts.min.js"></script>
<script type="text/javascript" src="../echart/theme/walden.js"></script>
<script type="text/javascript" src="../echart/map/HI.js"></script>
<script type="text/javascript" src="../echart/map/SH.js"></script>
<script type="text/javascript" src="../echart/map/HQ.js"></script>
<script type="text/javascript">
var chart1 ,option1;
var chart2 ,option2;
var chart3 ,option3;
$(document).ready(function(){
	//初始化首页数据
	initHomePageData();
	//待办
	$("#taskagents").click(function(){
		window.parent.addIframeTop("asserts/tpl/main/taskAgent.html","1000","待办任务");
	});
	
	
	//海南省的地图
	
	var prvCode=localStorage.getItem("prvCode");
	if(prvCode=="SH"){
		var chartSh =echarts.init(document.getElementById('mapchart'),'walden');
		chartSh.showLoading({
		    text: '正在努力的读取数据中...',    
		});
		var optionSh = { 
				dataRange: {
				        min: 0,
				        max: 4000,
				        x: 'left',
				        y: 'top',
				        text:['高','低'],// 文本，默认为数值文本   
				        calculable : true,
				        textStyle: {
				            fontSize:14
				        }
				},
			    series:[
			        {
			            type: 'map',
			            mapType:'上海',
			            itemStyle: {
			                normal: {
			                    borderColor: '#fff',
			                    areaColor:'#5ab7e0',
			                },
			                emphasis: {
			                    areaColor: '#0085d0',
			                    borderWidth: 0
			                } 
			            }
			        }
			    ]
			};
		chartSh.hideLoading();
		chartSh.setOption(optionSh,true);
		chartSh.on('click', function(param) {
			var regName = param.name;
			 $.ajax({
		            url:'homeIndex',
		            type:'post',
		            data:{
		            	regName:regName
		            },
		            async:true,//异步
		            dataType : 'json',
		        	contentType: "application/x-www-form-urlencoded;",
		            success: function(data) {
						if(data != null){
							var item1=data.obj.selfElecPaymentDetail_num;
							var item2=data.obj.selfTowerPaymentDetail_num;
							CreatelineSelfElecPaymentDetail(item1,item2)
						}
					},
		            error : function(data) {
		    			alertModel('获取失败!');
		    		}
		        });
			});

	}else if(prvCode=="HI"){
		var chartHn =echarts.init(document.getElementById('mapchart'),'walden');
		chartHn.showLoading({
		    text: '正在努力的读取数据中...',    
		});
		
		var optionHn = { 
				dataRange: {
				        min: 0,
				        max: 4000,
				        x: 'left',
				        y: 'top',
				        text:['高','低'],           // 文本，默认为数值文本   
				        calculable : true
				},
			    series:[
			        {
			            type: 'map',
			            mapType:'海南',
			            zoom: 3.5,
			            top:'600',
			            left:'400',
			            itemStyle: {
			                normal: {
			                    borderColor: '#fff',
			                    areaColor:'#5ab7e0',
			                },
			                emphasis: {
			                    areaColor: '#0085d0',
			                    borderWidth: 0
			                } 
			            },
			            layoutCenter: ['30%', '30%']
			            
			        }
			    ]
			};
		chartHn.hideLoading();
		chartHn.setOption(optionHn,true);
		chartHn.on('click', function(param) {
			var regName = param.name;
			 $.ajax({
		            url:'homeIndex',
		            type:'post',
		            data:{
		            	regName:regName
		            },
		            async:true,//异步
		            dataType : 'json',
		        	contentType: "application/x-www-form-urlencoded;",
		            success: function(data) {
						if(data != null){
							var item1=data.obj.selfElecPaymentDetail_num;
							var item2=data.obj.selfTowerPaymentDetail_num;
							CreatelineSelfElecPaymentDetail(item1,item2)
						}
					},
		            error : function(data) {
		    			alertModel('获取失败!');
		    		}
		        });
			});

	}else if(prvCode=="HQ"){//中国
		var chartHQ =echarts.init(document.getElementById('mapchart'),'walden');
		chartHQ.showLoading({
		    text: '正在努力的读取数据中...',    
		});
		
		var optionHQ = { 
				dataRange: {
			        min: 0,
			        max: 4000,
			        x: 'left',
			        y: 'top',
			        text:['高','低'],// 文本，默认为数值文本   
			        calculable : true,
			        textStyle: {
			            fontSize:14
			        }
			},
		    series:[
		        {
		            type: 'map',
		            mapType:'china',
		            zoom: 1,
		            itemStyle: {
		                normal: {
		                    borderColor: '#fff',
		                    areaColor:'#5ab7e0',
		                },
		                emphasis: {
		                    areaColor: '#0085d0',
		                    borderWidth: 0
		                } 
		            }
		        }
		    ]
		};
		chartHQ.hideLoading();
		chartHQ.setOption(optionHQ,true);
		chartHQ.on('click', function(param) {
			var regName = param.name;
			 $.ajax({
		            url:'homeIndex',
		            type:'post',
		            data:{
		            	prvName:regName
		            },
		            async:true,//异步
		            dataType : 'json',
		        	contentType: "application/x-www-form-urlencoded;",
		            success: function(data) {
						if(data != null){
							var item1=data.obj.selfElecPaymentDetail_num;
							var item2=data.obj.selfTowerPaymentDetail_num;
							CreatelineSelfElecPaymentDetail(item1,item2)
						}
					},
		            error : function(data) {
		    			alertModel('获取失败!');
		    		}
		        });
			});

	}else{
	
		$.get("../echart/map/"+prvCode+".json", function (geoJson) {
			var prvSname=localStorage.getItem("prvSname");
			//加载地图
			var chartMap =echarts.init(document.getElementById('mapchart'),'walden');
			window.onresize=chartMap.resize;
			// 过渡---------------------
			chartMap.showLoading({
			    text: '正在努力的读取数据中...',    
			});
			echarts.registerMap(prvSname, geoJson);                                                                                                                                                                                                                                                 
			var optionMap = { 
				dataRange: {
				        min: 0,
				        max: 4000,
				        x: 'left',
				        y: 'top',
				        text:['高','低'],           // 文本，默认为数值文本
				        calculable : true
				},
			    series:[
			        {
			            type: 'map',
			            mapType: prvSname,
			            zoom: 1,
			            itemStyle: {
			                normal: {
			                    borderColor: '#fff',
			                    areaColor:'#5ab7e0',
			                },
			                emphasis: {
			                    areaColor: '#0085d0',
			                    borderWidth: 0
			                } 
			            },
			            layoutCenter: ['30%', '30%']
			            
			        }
			    ]
			};
			//加载完数据后，隐藏加载提示
			chartMap.hideLoading();
			chartMap.setOption(optionMap,true);
		
		chartMap.on('click', function(param) {
			var regName = param.name;
			 $.ajax({
		            url:'homeIndex',
		            type:'post',
		            data:{
		            	regName:regName
		            },
		            async:true,//异步
		            dataType : 'json',
		        	contentType: "application/x-www-form-urlencoded;",
		            success: function(data) {
						if(data != null){
							var item1=data.obj.selfElecPaymentDetail_num;
							var item2=data.obj.selfTowerPaymentDetail_num;
							CreatelineSelfElecPaymentDetail(item1,item2)
						}
					},
		            error : function(data) {
		    			alertModel('获取失败!');
		    		}
		        });
			});
		});
	}
	
	calculate();
	function calculate(){
		var h=$(window).height();
		$('.home-parent').css({'height':h-5});
	}
	//加载月份折线图
	/* var chartLine = echarts.init(document.getElementById('linechart'),'walden');
	window.onresize=chartLine.resize;
	var lineOption = {
			tooltip : {
		        trigger: 'axis',
		        axisPointer: {
		            type: 'cross',
		            label: {
		                backgroundColor: '#6a7985'
		            }
		        }
		    },
	    legend: {
	    	bottom:10,
	    	height:10,
	    	itemWidth:16,
	    	itemHeight:16,
	    	data:[
	    	      {name:'自维电费',icon:'image://../image/first.png'},
	    	      {name:'塔维电费',icon:'image://../image/second.png'},
	    	      {name:'自维房租',icon:'image://../image/third.png'},
	    	      {name:'塔维租赁费',icon:'image://../image/fourth.png'}
	    	]
	    },
	    toolbox: {
	        feature: {
	            saveAsImage: {}
	        }
	    },
	    grid: {
	        left: '3%',
	        right: '4%',
	        bottom: '10%',
	        containLabel: true,
	        tooltip:{
	        	axisPointer:{
	        		lineStyle:{
	        			color:'#566072'
	        		}
	        	}
	        }
	    },
	    calculable : true,
	    xAxis :{
	    	type : 'category',
	        boundaryGap : false,
	        data : ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],
	        
	        splitLine: {show: false},
	        axisTick:{
	        	show:true,
	        	lineStyle:{
	        		color:'#c4c4c4'
	        	}
	        }
	    },
	    yAxis :{
	        type : 'value',
	        axisLabel : {
	            formatter: '{value}'
	        },
	        axisTick:{
	        	show:true,
	        	lineStyle:{
	        		color:'#c4c4c4'
	        	}
	        }
	    },
	                                                  
	    series : [
	        {
	            name:'自维电费',
	            type:'line',
	            areaStyle: {normal: {}},
	            data:[12000,10100,13800,14700,15500,18900,17890,16320,13200,14500,13200,16800]
	        },
	        {
	            name:'塔维电费',
	            type:'line',
	            areaStyle: {normal: {}},
	            data:[9800,9500,8300,9200,9900,9560,9490,8920,8700,9100,8900,8100]
	        },
	        {
	            name:'自维房租',
	            type:'line',
	            areaStyle: {normal: {}},
	            data:[7800,6500,8200,7300,6600,5360,6290,6920,7500,8900,9100,7800]
	        },
	        {
	            name:'塔维租赁费',
	            type:'line',
	            areaStyle: {normal: {}},
	            data:[4300,4500,5800,6500,5300,6760,7290,7320,6700,7100,6500,6800]
	        }
	    ]
	};
	chartLine.setOption(lineOption);
     */
	/* window.onresize = function () {
		calculate();
        chartLine.resize();
        chart1.resize();
        chart2.resize();
        chart3.resize();
    } */
	
	/**
	 * 初始化首页数据
	 */
	function initHomePageData(){
		$.ajax({
			url : 'homeIndex',   
			data : {},
			type : 'get',
			cache : false,
			dataType : 'json',
			success : function(back) {
				if(typeof(back.msg)==undefined){
					alertModel('页面登录失效');
					return;
				}
				if(back!=null && back!=undefined){
					if(back.success == "1"){
						setTodoList(back.obj.todonums);//待办数量
						
						CreateContractECharts(back.obj.contract_num);
						CreateElecMeterECharts(back.obj.elemeter_num);
						CreateResourceECharts(back.obj.resource_num);
						setTodoList(back.obj.todonums);//待办数量
						CreatelineSelfElecPaymentDetail(back.obj.selfElecPaymentDetail_num,back.obj.selfTowerPaymentDetail_num);//折线图
						/* loadMap(regName); */
						$(".nolinkContractLv").text(back.obj.nolink_contract_lv);
						$(".nolinkContractLv").parent(".digit").siblings(".bar").
							children(".progress").css("width",+$(".nolinkContractLv").text()+"%");
						$(".nolink_resource_lv").text(back.obj.nolink_resource_lv);
						$(".nolink_resource_lv").parent(".digit").siblings(".bar").
							children(".progress").css("width",+$(".nolink_resource_lv").text()+"%");
						$(".pushBillLv").text(back.obj.pushBillLv);
						$(".pushBillLv").parent(".digit").siblings(".bar").
						children(".progress").css("width",+$(".pushBillLv").text()+"%");
						$(".nolink_elemeter_lv").text(back.obj.nolink_elemeter_lv);
						$(".nolink_elemeter_lv").parent(".digit").siblings(".bar").
						children(".progress").css("width",+$(".nolink_elemeter_lv").text()+"%");
						$(".allres").text(back.obj.allres);
						$(".nolinkedres").text(back.obj.nolinkedres);
						$(".allmeter").text(back.obj.allmeter);
						$(".nolinkedmeter").text(back.obj.nolinkedmeter);
						$(".allaccount").text(back.obj.allaccount);
						$(".pushedBill").text(back.obj.pushedBill);
						$(".allpushbill").text(back.obj.allpushbill);
						setInterval(setTodo,60000);
					}
					else{
						alertModel(back.msg);
					}
				}
			},
			error : function() {
			}
		});
	}
	//每隔1分钟回去一次待办
	//setInterval(setTodo,1000);
	function setTodo(){
		//queryTodoList
		//setTodoList(back.obj.todonums);//待办数量
		$.ajax({
             url:'queryTodoList',
             type:'get',
 			 cache : false,
 			 dataType : 'json',
             async:true,    //异步
             success:function(back){
            	 setTodoList(back.obj.todonums);
             }
		}); 
	}
	function setTodoList(todonums){
		$(".task_agents .digit").html(todonums);
		top.setTodoNum(todonums);
	}
	function CreateContractECharts(contract_num){
		// 全省合同数
	    chart1 = echarts.init(document.getElementById('main-bing1'), 'walden');
	    // 配置
	    option1 = {
		    title : {
		         text: '电租合同总数', 
		        subtext: '',
		        x:'left',
		        textStyle: {
		            fontSize: 14,
		            color:'#666'
	        	},
		    },
		    tooltip : {
		        trigger: 'item',
		        position:function(p){   //其中p为当前鼠标的位置
	            	return [p[0] - 50, p[1] + 20];
	        	},
		        formatter: "{a} <br/>{b} : {c} ({d}%)"
		    },
	    	series : [
		        {
		            name:'合同数量',
		            type:'pie',
		            radius : '75%',
		            center: ['50%', '50%'],
		            data: contract_num,
		            itemStyle: {
		            	normal: {
			                label: {
			                    show: false,
			                    position: 'outer',
			                    textStyle: {
			                    }
			                },
			                labelLine: {
			                    show: false,
			                    length: 5,
			                    lineStyle: {
			                        width: 1,
			                        type: 'solid'
			                    }
			                }
			            }
		            }
		        }
		    ]
		};
	    chart1.setOption(option1);
	}
	function CreateResourceECharts(resource_num){
	
		//全省机房+资源点数
	    chart2 = echarts.init(document.getElementById('main-bing2'),'walden');
	    // 配置
	    option2 = {
		    title : {
		        text: '机房资源总数',
		        subtext: '',
		        x:'left',
		        textStyle: {
		            fontSize: 14,
		            color:'#666'
	        	},
		    },
		    tooltip : {
		        trigger: 'item',
		        position:function(p){   
	            	return [p[0] - 50, p[1] - 80];
	        	},
	        	formatter: "{a} <br/>{b} : {c} ({d}%)"
		    },
		    series : [
		        {
		            name:'资源数量',
		            type:'pie',
		            radius : '75%',
		            center: ['50%', '50%'],
		            data: resource_num,
		            itemStyle: {
		            	normal: {
			                label: {
			                    show: false,
			                    position: 'outer'
			                },
			                labelLine: {
			                    show: true,
			                    length: 5,
			                    lineStyle: {
			                        width: 1,
			                        type: 'solid'
			                    }
			                }
			            }
		            }
		        }
		    ]
		};
	    chart2.setOption(option2);
	}
	function CreateElecMeterECharts(elemeter_num){
		//全省电表数
	    chart3 = echarts.init(document.getElementById('main-bing3'),'walden');
	    // 配置
	    option3 = {
		    title : {
		     	text: '电表总数',
		        x:'left',
		        textStyle: {
		            fontSize: 14,
		            color:'#666'
	        	},
		    },
		    tooltip : {
		        trigger: 'item',
		        position:function(p){   
	            	return [p[0] - 50, p[1] - 80];
	        	},
		        formatter: "{a} <br/>{b} : {c} ({d}%)"
		    },
		    series : [
		        {
		            name:'电表数量',
		            type:'pie',
		            radius : '75%',
		            center: ['50%', '50%'],
		            data: elemeter_num,
		            itemStyle: {
		            	normal: {
			                label: {
			                    show: false,
			                    position: 'outer'
			                },
			                labelLine: {
			                    show: true,
			                    length: 5,
			                    lineStyle: {
			                        width: 1,
			                        type: 'solid'
			                    }
			                }
			            }
		            }
		        }
		    ]
		};
	    chart3.setOption(option3); 
	}

function CreatelineSelfElecPaymentDetail(item1,item2){
	//加载月份折线图
	var chartLine = echarts.init(document.getElementById('linechart'), 'walden');
			
	window.onresize = chartLine.resize;
	
	var lineOption = {
			tooltip : {
		        trigger: 'axis',
		        axisPointer: {
		            type: 'cross',
		            label: {
		                backgroundColor: '#6a7985'
		            }
		        }
		    },
		    legend: {
		    	bottom:10,
		    	height:10,
		    	itemWidth:16,
		    	itemHeight:16,
		    	data:[
		    	      {name:'自维电费',icon:'image://../image/first.png'},
		    	      {name:'塔维电费',icon:'image://../image/second.png'},
		    	      {name:'自维房租',icon:'image://../image/third.png'},
		    	      {name:'塔维租赁费',icon:'image://../image/fourth.png'}
		    	]
		    },
		    toolbox: {
		        feature: {
		            saveAsImage: {}
		        }
		    },
		    grid: {
		        left: '3%',
		        right: '4%',
		        bottom: '10%',
		        containLabel: true,
		        tooltip:{
		        	axisPointer:{
		        		lineStyle:{
		        			color:'#566072'
		        		}
		        	}
		        }
		    },
		    calculable : true,
		    xAxis :{
		    	type : 'category',
		        boundaryGap : false,
		        data : ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],
		        
		        splitLine: {show: false},
		        axisTick:{
		        	show:true,
		        	lineStyle:{
		        		color:'#c4c4c4'
		        	}
		        }
		    },
		    yAxis :{
		        type : 'value',
		        axisLabel : {
		            formatter: '{value}'
		        },
		        axisTick:{
		        	show:true,
		        	lineStyle:{
		        		color:'#c4c4c4'
		        	}
		        }
		    },
		series : [
				{
					name : '自维电费',
					type : 'line',
					areaStyle : {
						normal : {}
					},
					data : item1
				},
				{
					name : '塔维电费',
					type : 'line',
					areaStyle : {
						normal : {}
					},
					data : item2
				},
				{
					name : '自维房租',
					type : 'line',
					areaStyle : {
						normal : {}
					},
					data : [ 8, 5, 2, 0, 6, 13,
							12, 19, 5, 15, 1, 18 ]
				},
				{
					name : '塔维租赁费',
					type : 'line',
					areaStyle : {
						normal : {} 
					},
					data : [ 13, 5, 9, 15, 13, 17,
							12, 1, 17, 11, 10, 18 ]
				} ]
	};

	chartLine.setOption(lineOption);
}
});
</script>
</body>
</html>