<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xunge.dao.towerrent.accountsummary.TwrAccountsummaryVODao">
  <resultMap id="BaseResultMap" type="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO">
    <id column="accountsummary_id" jdbcType="VARCHAR" property="accountsummaryId" />
    <result column="yearmonth" jdbcType="VARCHAR" property="yearmonth" />
    <result column="reg_id" jdbcType="VARCHAR" property="regId" />
    <result column="sum_amount_type" jdbcType="VARCHAR" property="sumAmountType" />
    <result column="sum_tower_amount" jdbcType="DECIMAL" property="sumTowerAmount" />
    <result column="sum_diff_amount" jdbcType="DECIMAL" property="sumDiffAmount" />
    <result column="sum_adjustment_amount" jdbcType="DECIMAL" property="sumAdjustmentAmount" />
    <result column="sum_calc_amount" jdbcType="DECIMAL" property="sumCalcAmount" />
    <result column="sum_hist_amount" jdbcType="DECIMAL" property="sumHistAmount" />
    <result column="debit_type" jdbcType="VARCHAR" property="debitType" />
    <result column="sum_back_amount" jdbcType="DECIMAL" property="sumBackAmount" />
    <result column="sum_total_amount" jdbcType="DECIMAL" property="sumTotalAmount" />
    <result column="sum_total_amount_tax" jdbcType="DECIMAL" property="sumTotalAmountTax" />
    <result column="state" jdbcType="INTEGER" property="state" />
    <result column="create_user_id" jdbcType="VARCHAR" property="createUserId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_user_id" jdbcType="VARCHAR" property="updateUserId" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    accountsummary_id, yearmonth, reg_id, sum_amount_type, sum_tower_amount, sum_adjustment_amount,sum_diff_amount, 
    sum_calc_amount, sum_hist_amount, debit_type, sum_back_amount, sum_total_amount, 
    sum_total_amount_tax, state, create_user_id, create_time, update_user_id, update_time
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from twr_accountsummary
    where accountsummary_id = #{accountsummaryId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from twr_accountsummary
    where accountsummary_id = #{accountsummaryId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO" useGeneratedKeys="true" keyProperty="accountsummaryId">
    insert into twr_accountsummary (accountsummary_id, yearmonth, reg_id, 
      sum_amount_type, sum_tower_amount, sum_diff_amount, 
      sum_calc_amount, sum_hist_amount, debit_type, 
      sum_back_amount, sum_total_amount, sum_total_amount_tax, 
      state, create_user_id, create_time, 
      update_user_id, update_time, sum_adjustment_amount)
    values (#{accountsummaryId,jdbcType=VARCHAR}, #{yearmonth,jdbcType=VARCHAR}, #{regId,jdbcType=VARCHAR}, 
      #{sumAmountType,jdbcType=VARCHAR}, #{sumTowerAmount,jdbcType=DECIMAL}, #{sumDiffAmount,jdbcType=DECIMAL}, 
      #{sumCalcAmount,jdbcType=DECIMAL}, #{sumHistAmount,jdbcType=DECIMAL}, #{debitType,jdbcType=VARCHAR}, 
      #{sumBackAmount,jdbcType=DECIMAL}, #{sumTotalAmount,jdbcType=DECIMAL}, #{sumTotalAmountTax,jdbcType=DECIMAL}, 
      #{state,jdbcType=INTEGER}, #{createUserId,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{updateUserId,jdbcType=VARCHAR}, #{updateTime,jdbcType=TIMESTAMP}, #{sumAdjustmentAmount,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO" useGeneratedKeys="true" keyProperty="accountsummaryId">
    insert into twr_accountsummary
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="accountsummaryId != null">
        accountsummary_id,
      </if>
      <if test="yearmonth != null">
        yearmonth,
      </if>
      <if test="regId != null">
        reg_id,
      </if>
      <if test="sumAmountType != null">
        sum_amount_type,
      </if>
      <if test="sumTowerAmount != null">
        sum_tower_amount,
      </if>
      <if test="sumDiffAmount != null">
        sum_diff_amount,
      </if>
      <if test="sumCalcAmount != null">
        sum_calc_amount,
      </if>
      <if test="sumHistAmount != null">
        sum_hist_amount,
      </if>
      <if test="debitType != null">
        debit_type,
      </if>
      <if test="sumBackAmount != null">
        sum_back_amount,
      </if>
      <if test="sumTotalAmount != null">
        sum_total_amount,
      </if>
      <if test="sumTotalAmountTax != null">
        sum_total_amount_tax,
      </if>
      <if test="state != null">
        state,
      </if>
      <if test="createUserId != null">
        create_user_id,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateUserId != null">
        update_user_id,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="sumAdjustmentAmount != null">
        sum_adjustment_amount,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="accountsummaryId != null">
        #{accountsummaryId,jdbcType=VARCHAR},
      </if>
      <if test="yearmonth != null">
        #{yearmonth,jdbcType=VARCHAR},
      </if>
      <if test="regId != null">
        #{regId,jdbcType=VARCHAR},
      </if>
      <if test="sumAmountType != null">
        #{sumAmountType,jdbcType=VARCHAR},
      </if>
      <if test="sumTowerAmount != null">
        #{sumTowerAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumDiffAmount != null">
        #{sumDiffAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumCalcAmount != null">
        #{sumCalcAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumHistAmount != null">
        #{sumHistAmount,jdbcType=DECIMAL},
      </if>
      <if test="debitType != null">
        #{debitType,jdbcType=VARCHAR},
      </if>
      <if test="sumBackAmount != null">
        #{sumBackAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumTotalAmount != null">
        #{sumTotalAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumTotalAmountTax != null">
        #{sumTotalAmountTax,jdbcType=DECIMAL},
      </if>
      <if test="state != null">
        #{state,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null">
        #{createUserId,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null">
        #{updateUserId,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sumAdjustmentAmount != null">
        #{sumAdjustmentAmount,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO">
    update twr_accountsummary
    <set>
      <if test="yearmonth != null">
        yearmonth = #{yearmonth,jdbcType=VARCHAR},
      </if>
      <if test="regId != null">
        reg_id = #{regId,jdbcType=VARCHAR},
      </if>
      <if test="sumAmountType != null">
        sum_amount_type = #{sumAmountType,jdbcType=VARCHAR},
      </if>
      <if test="sumTowerAmount != null">
        sum_tower_amount = #{sumTowerAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumDiffAmount != null">
        sum_diff_amount = #{sumDiffAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumCalcAmount != null">
        sum_calc_amount = #{sumCalcAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumHistAmount != null">
        sum_hist_amount = #{sumHistAmount,jdbcType=DECIMAL},
      </if>
      <if test="debitType != null">
        debit_type = #{debitType,jdbcType=VARCHAR},
      </if>
      <if test="sumBackAmount != null">
        sum_back_amount = #{sumBackAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumTotalAmount != null">
        sum_total_amount = #{sumTotalAmount,jdbcType=DECIMAL},
      </if>
      <if test="sumTotalAmountTax != null">
        sum_total_amount_tax = #{sumTotalAmountTax,jdbcType=DECIMAL},
      </if>
      <if test="state != null">
        state = #{state,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null">
        create_user_id = #{createUserId,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUserId != null">
        update_user_id = #{updateUserId,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sumAdjustmentAmount != null">
        sum_adjustment_amount = #{sumAdjustmentAmount,jdbcType=DECIMAL},
      </if>
    </set>
    where accountsummary_id = #{accountsummaryId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO">
    update twr_accountsummary
    set yearmonth = #{yearmonth,jdbcType=VARCHAR},
      reg_id = #{regId,jdbcType=VARCHAR},
      sum_amount_type = #{sumAmountType,jdbcType=VARCHAR},
      sum_tower_amount = #{sumTowerAmount,jdbcType=DECIMAL},
      sum_diff_amount = #{sumDiffAmount,jdbcType=DECIMAL},
      sum_calc_amount = #{sumCalcAmount,jdbcType=DECIMAL},
      sum_hist_amount = #{sumHistAmount,jdbcType=DECIMAL},
      debit_type = #{debitType,jdbcType=VARCHAR},
      sum_back_amount = #{sumBackAmount,jdbcType=DECIMAL},
      sum_total_amount = #{sumTotalAmount,jdbcType=DECIMAL},
      sum_total_amount_tax = #{sumTotalAmountTax,jdbcType=DECIMAL},
      state = #{state,jdbcType=INTEGER},
      create_user_id = #{createUserId,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_user_id = #{updateUserId,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      sum_adjustment_amount = #{sumAdjustmentAmount,jdbcType=DECIMAL}
    where accountsummary_id = #{accountsummaryId,jdbcType=VARCHAR}
  </update>
  
  <!-- 根据参数查询费用汇总集合 -->
  <select id="queryTwrAccountsummeryMapListByCondition" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT
	a.accountsummary_id,
	a.yearmonth,
	a.reg_id,
	a.sum_amount_type,
	a.sum_tower_amount,
	a.sum_diff_amount,
	a.sum_calc_amount,
	a.sum_hist_amount,
	a.debit_type,
	a.sum_back_amount,
	a.sum_total_amount,
	a.sum_total_amount_tax,
	a.sum_adjustment_amount,
	a.state,
	reg.preg_id,
	reg.reg_name,
	reg.prv_id,
	reg.reg_state,
	reg.preg_name,
	reg.prv_name
FROM
	twr_accountsummary a
	INNER JOIN v_sys_region reg on reg.reg_id = a.reg_id
	<where>
		<if test="yearmonth != null and yearmonth != ''">
			and a.yearmonth = #{yearmonth}
		</if>
		<if test="prvId != '' and prvId != null">
			and reg.prv_id = #{prvId}
		</if>
		<if test="pregId != '' and pregId != null">
			and reg.preg_id = #{pregId}
		</if>
		<if test="regId != null">
  			and a.reg_id = #{regId}
  		</if>
  		<if test="regId == null">
			and reg.reg_id in (
			select reg_id from sys_userregion 
			where relation_state=#{state}
				and user_id = #{userId}
			)
		</if>
		<if test="idsList != null">
			and accountsummary_id in
			<foreach collection="idsList" item="item" open="(" separator=","
		            close=")">
		     	#{item}
		    </foreach>
		</if>
	</where>
  </select>
  
  <delete id="deleteTwrAccountsummaryByCondition" parameterType="java.util.Map">
    delete from twr_accountsummary
		where accountsummary_id in
		<foreach collection="idsList" item="item" open="(" separator=","
                close=")">
            #{item}
        </foreach>
  </delete>
  
  <!-- 根据费用汇总单Id查询验证提交过的费用汇总单数量 -->
  <select id="selectSubmitedAccountsummaryCountByCondition" parameterType="java.util.Map" resultType="java.lang.Integer">
  	SELECT
		count(1)
	FROM
		twr_accountsummary tas
	WHERE tas.state != -1 and tas.state != 8 
	AND tas.accountsummary_id in 
	<foreach collection="idsList" item="item" open="(" separator=","
            close=")">
     	#{item}
    </foreach>
  </select>
  
  <!-- 根据参数查询费用汇总集合 -->
  <select id="queryTwrAccountsummeryMapListByCondition1" parameterType="java.util.Map" resultType="java.util.Map">
	SELECT
	a.accountsummary_id, 
	a.yearmonth, 
	a.reg_id, 
	a.sum_amount_type, 
	a.sum_tower_amount, 
	a.sum_diff_amount, 
    a.sum_calc_amount, 
    a.sum_hist_amount, 
    a.debit_type, 
    a.sum_back_amount, 
    a.sum_total_amount, 
    a.sum_total_amount_tax, 
    a.state, 
    a.create_user_id, 
    a.create_time, 
    a.update_user_id, 
    a.update_time,
    a.sum_adjustment_amount,
	reg.preg_id,
	reg.reg_name,
	reg.prv_id,
	reg.reg_state,
	reg.preg_name,
	reg.prv_name
FROM
	twr_accountsummary a
	INNER JOIN v_sys_region reg on reg.reg_id = a.reg_id
	<where>
		<if test="yearmonth != null and yearmonth != ''">
			and a.yearmonth = #{yearmonth}
		</if>
		<if test="prvId != '' and prvId != null">
			and reg.prv_id = #{prvId}
		</if>
		<if test="pregId != '' and pregId != null">
			and reg.preg_id = #{pregId}
		</if>
		<if test="regId != null">
  			and a.reg_id = #{regId}
  		</if>
		<if test="idsList != null">
			and accountsummary_id in
			<foreach collection="idsList" item="item" open="(" separator=","
		            close=")">
		     	#{item}
		    </foreach>
		</if>
	</where>
  </select>
  
  <!-- 包含运营商地市的结果集映射 wangz -->
  <resultMap id="accountSummaryResultMap" type="com.xunge.model.towerrent.accountsummary.TwrAccountsummaryVO">
    <id column="accountsummary_id" jdbcType="VARCHAR" property="accountsummaryId" />
    <result column="yearmonth" jdbcType="VARCHAR" property="yearmonth" />
    <result column="reg_id" jdbcType="VARCHAR" property="regId" />
    <result column="sum_amount_type" jdbcType="VARCHAR" property="sumAmountType" />
    <result column="sum_tower_amount" jdbcType="DECIMAL" property="sumTowerAmount" />
    <result column="sum_diff_amount" jdbcType="DECIMAL" property="sumDiffAmount" />
    <result column="sum_adjustment_amount" jdbcType="DECIMAL" property="sumAdjustmentAmount" />
    <result column="sum_calc_amount" jdbcType="DECIMAL" property="sumCalcAmount" />
    <result column="sum_hist_amount" jdbcType="DECIMAL" property="sumHistAmount" />
    <result column="debit_type" jdbcType="VARCHAR" property="debitType" />
    <result column="sum_back_amount" jdbcType="DECIMAL" property="sumBackAmount" />
    <result column="sum_total_amount" jdbcType="DECIMAL" property="sumTotalAmount" />
    <result column="sum_total_amount_tax" jdbcType="DECIMAL" property="sumTotalAmountTax" />
    <result column="state" jdbcType="INTEGER" property="state" />
    <result column="sum_adjustment_amount" jdbcType="DECIMAL" property="sumAdjustmentAmount" />
    <result column="create_user_id" jdbcType="VARCHAR" property="createUserId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_user_id" jdbcType="VARCHAR" property="updateUserId" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <association property="operatorSysRegion" javaType="com.xunge.model.system.region.SysRegionVO">
          <result column="preg_id" property="regId" />
          <result column="reg_name" property="regName" />
          <result column="prv_id" property="prvId" />
          <result column="reg_state" property="regState" />
          <result column="preg_name" property="pregName" />
          <result column="prv_name" property="prvName" />
     </association>
  </resultMap>
  <!-- 审核列表  wagnz-->
  <select id="queryPageTwrAccountsummery" parameterType="java.util.Map" resultMap="accountSummaryResultMap">
	SELECT
	a.accountsummary_id,
	a.yearmonth,
	a.reg_id,
	a.sum_amount_type,
	a.sum_tower_amount,
	a.sum_diff_amount,
	a.sum_calc_amount,
	a.sum_hist_amount,
	a.debit_type,
	a.sum_back_amount,
	a.sum_total_amount,
	a.sum_total_amount_tax,
	a.state,
	a.sum_adjustment_amount,
	reg.preg_id,
	reg.reg_name,
	reg.prv_id,
	reg.reg_state,
	reg.preg_name,
	reg.prv_name
	FROM
	twr_accountsummary a
	INNER JOIN v_sys_region reg on reg.reg_id = a.reg_id
	<where>
		<if test="yearmonth != null and yearmonth != ''">
			and a.yearmonth = #{yearmonth}
		</if>
		<if test="state != null and state != ''">
			and a.state = #{state}
		</if>
		<if test="pregId != null and pregId != ''">
  			and a.reg_id = #{pregId}
  		</if>
  		<!-- 根据权限过滤 -->
  		<include refid="com.xunge.dao.system.SysRegionVOMapper.queryRegionByUserIds"></include>
		<if test="null != accountIds and '' != accountIds ">
			and a.accountsummary_id in
			<foreach collection="accountIds" index="index" item="item" open="(" separator="," close=")">    
	            #{item}    
	        </foreach>  
		</if>
	</where>
  </select>
  
  <!-- 根据ID编码查询 -->
  <select id="queryAccountsummeryById" parameterType="java.util.Map" resultMap="accountSummaryResultMap">
	SELECT
	a.accountsummary_id,
	a.yearmonth,
	a.reg_id,
	a.sum_amount_type,
	a.sum_tower_amount,
	a.sum_diff_amount,
	a.sum_calc_amount,
	a.sum_hist_amount,
	a.debit_type,
	a.sum_back_amount,
	a.sum_total_amount,
	a.sum_total_amount_tax,
	a.state,
	a.sum_adjustment_amount,
	reg.preg_id,
	reg.reg_name,
	reg.prv_id,
	reg.reg_state,
	reg.preg_name,
	reg.prv_name
	FROM
	twr_accountsummary a
	INNER JOIN v_sys_region reg on reg.reg_id = a.reg_id
	<where>
		<if test="state != null and state != ''">
			and a.state = #{state}
		</if>
		<if test="null != accountId and '' != accountId ">
			and a.accountsummary_id = #{accountId}
		</if>
	</where>
  </select>
</mapper>