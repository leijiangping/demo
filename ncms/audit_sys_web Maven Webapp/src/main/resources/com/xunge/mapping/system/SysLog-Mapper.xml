<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xunge.dao.system.LogMapper" >
  <resultMap id="BaseResultMap" type="com.xunge.model.system.log.SysLogVO" >
    <id column="log_id" property="logId" jdbcType="VARCHAR"/>
    <result column="prv_name" property="prvName" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="menu_id" property="menuId" jdbcType="VARCHAR" />
    <result column="log_type" property="logType" jdbcType="VARCHAR" />
    <result column="log_ip" property="logIp" jdbcType="VARCHAR" />
    <result column="log_time" property="logTime" jdbcType="VARCHAR" />
    <result column="log_note" property="logNote" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR"/>
  </resultMap>
  
  <!-- 插入新日志记录 -->
  <insert id="insertLog" parameterType="com.xunge.model.system.log.SysLogVO">
    insert into sys_log (
	    log_id, 
	    prv_id,
	    user_id, 
	    menu_id, 
	    log_type, 
	    log_ip, 
	    log_time, 
	    log_note
    )
    values (
    	#{logId,jdbcType=VARCHAR}, 
    	#{prvId,jdbcType=VARCHAR}, 
    	#{userId,jdbcType=VARCHAR}, 
    	#{menuId,jdbcType=VARCHAR}, 
    	#{ilogType,jdbcType=INTEGER}, 
    	#{logIp,jdbcType=VARCHAR}, 
    	now(), 
    	#{logNote,jdbcType=VARCHAR}
    )
  </insert>
  
	<sql id="Search_Column_List" >
   		l.log_id,u.user_name, l.log_note,l.log_time,l.log_ip,p.prv_name,
  		case l.log_type when 10 then '操作日志' when 20 then '错误日志' when 30 then '登陆日志' end as log_type
	</sql>
  
  <!-- 模糊查询 -->
  <select id="queryLogMsg" parameterType="Map" resultMap="BaseResultMap">
  	select 
  		<include refid="Search_Column_List" />
  	from 
  		sys_log l,sys_user u,sys_province p
  	where
  		l.user_id = u.user_id
  	and l.prv_id=p.prv_id
	<if test="prvId!=null and prvId!=''">
		and l.prv_id = #{prvId}
	</if>
	<if test="logType!=null and logType!=''">
		and l.log_type = #{logType,jdbcType=INTEGER}
	</if>
	<if test="startTime!=null and startTime!=''"> 
		and l.log_time &gt;= #{startTime}
	</if>  
	<if test="endTime!=null and endTime!=''"> 
		and l.log_time &lt;  #{endTime}
	</if>
	<if test="keyNote!=null and keyNote!=''"> 
		and l.log_note like CONCAT('%',#{keyNote},'%')
	</if>  
	order by log_time desc
  </select>
   <!-- 删除日志 -->
   <delete id="deleteLogMsg" parameterType="Map">
   	delete from sys_log 
   	where log_id in
   	<foreach collection="logIds" item="item" index="index" open="(" separator="," close=")">
   		 #{item}
   	</foreach>
   </delete>
</mapper>